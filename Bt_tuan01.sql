USE HOCSINHDB;

CREATE TABLE CHUDE(
	MACD CHAR(4),
    TENCD NVARCHAR(40)
);
ALTER TABLE CHUDE
ADD CONSTRAINT PK_CHUDE
PRIMARY KEY (MACD);

CREATE TABLE KHOA(
	MAKHOA VARCHAR(5),
    TENKHOA NVARCHAR(20),
    NAMTL INT,
    PHONG VARCHAR(15),
    DIENTHOAI VARCHAR(15),
    TRUONGKHOA VARCHAR(5),
    NGAYNHANCHUC DATETIME,
	PRIMARY KEY (MAKHOA)
);



CREATE TABLE BOMON(
	MABM VARCHAR(5),
    TENBM NVARCHAR(50),
    PHONG NVARCHAR(10),
    DIENTHOAI VARCHAR(15),
    TRUONGBM VARCHAR(5),
    MAKHOA VARCHAR(5),
    NGAYNHANCHUC DATE,
    PRIMARY KEY(MABM)
);


CREATE TABLE GIAOVIEN(
	MAGV VARCHAR(5),
    HOTEN NVARCHAR(50),
    LUONG NUMERIC(10,2),
    PHAI NVARCHAR(5),
    NGAYSINH DATE,
    DIACHI NVARCHAR(100),
    GVQLCM VARCHAR(5),
    MABM VARCHAR(5),
    PRIMARY KEY(MAGV)
);




CREATE TABLE DETAI (
	MADT VARCHAR(5),
    TENDT NVARCHAR(100),
    CAPQL NVARCHAR(20),
    KINHPHI NUMERIC(12,2),
	NGAYBD DATE,
    NGAYKT DATE,
    MACD VARCHAR(5),
    GVCNDT VARCHAR(5),
    PRIMARY KEY(MADT)
);


CREATE TABLE CONGVIEC(
	MADT VARCHAR(5),
    SOTT INT,
    TENCV NVARCHAR(30),
    NGAYBD DATE,
    NGAYKT DATE,
    PRIMARY KEY (MADT,SOTT)
);


CREATE TABLE NGUOITHAN(
	MAGV VARCHAR(5),
    TEN NVARCHAR(30),
    NGSINH DATE,
    PHAI NVARCHAR(5),
    PRIMARY KEY(MAGV,TEN)
);


CREATE TABLE GV_DT(
	MAGV VARCHAR(5),
    DIENTHOAI VARCHAR(15),
    PRIMARY KEY(MAGV,DIENTHOAI)
);


CREATE TABLE THAMGIADT(
	MAGV VARCHAR(5),
    MADT VARCHAR(5),
    STT INT,
    PHUCAP NUMERIC(5,2),
    KETQUA NVARCHAR(20),
    PRIMARY KEY(MAGV,MADT,STT)
);


INSERT INTO CHUDE (MACD, TENCD) VALUES (N'NCPT', N'Nghiên cứu phát triển');
INSERT INTO CHUDE (MACD, TENCD) VALUES (N'QLGD', N'Quản lý giáo dục');
INSERT INTO CHUDE (MACD, TENCD) VALUES (N'ƯDCN', N'Ứng dụng công nghệ');


INSERT INTO KHOA (MAKHOA, TENKHOA, NAMTL, PHONG, DIENTHOAI, NGAYNHANCHUC) VALUES (N'CNTT', N'Công nghệ thông tin', N'1995', N'B11', N'0838123456', CAST(N'2005-02-20' AS Date));
INSERT INTO KHOA (MAKHOA, TENKHOA, NAMTL, PHONG, DIENTHOAI, NGAYNHANCHUC) VALUES (N'HH', N' Hóa học', N'1980', N'B31', N'0838454545', CAST(N'2000-10-11' AS Date));
INSERT INTO KHOA (MAKHOA, TENKHOA, NAMTL, PHONG, DIENTHOAI, NGAYNHANCHUC) VALUES (N'SH', N'Sinh học', N'1980', N'B41', N'0838456465', CAST(N'2001-10-15' AS Date));
INSERT INTO KHOA (MAKHOA, TENKHOA, NAMTL, PHONG, DIENTHOAI, NGAYNHANCHUC) VALUES (N'VL', N'Vật lý', N'1976', N'B21', N'0838223223', CAST(N'2003-09-18' AS Date));


INSERT INTO BOMON (MABM, TENBM, PHONG, DIENTHOAI, MAKHOA, NGAYNHANCHUC) VALUES (N'CNTT', N'Công nghệ tri thức', N'B15', N'0838126126', N'CNTT', NULL);
INSERT INTO BOMON (MABM, TENBM, PHONG, DIENTHOAI, MAKHOA, NGAYNHANCHUC) VALUES (N'HHC', N'Hóa hữu cơ', N'B44', N'838222222', N'HH', NULL);
INSERT INTO BOMON (MABM, TENBM, PHONG, DIENTHOAI, MAKHOA, NGAYNHANCHUC) VALUES (N'HL', N'Hóa lý', N'B42', N'0838878787', N'HH', NULL);
INSERT INTO BOMON (MABM, TENBM, PHONG, DIENTHOAI, MAKHOA, NGAYNHANCHUC) VALUES (N'HPT', N'Hóa phân tích', N'B43', N'0838777777', N'HH', CAST(N'2007-10-15' AS Date));
INSERT INTO BOMON (MABM, TENBM, PHONG, DIENTHOAI, MAKHOA, NGAYNHANCHUC) VALUES (N'HTTT', N'Hệ thống thông tin', N'B13', N'0838125125', N'CNTT', CAST(N'2004-09-20' AS Date));
INSERT INTO BOMON (MABM, TENBM, PHONG, DIENTHOAI, MAKHOA, NGAYNHANCHUC) VALUES (N'MMT', N'Mạng máy tính', N'B16', N'0838676767', N'CNTT', CAST(N'2005-05-15' AS Date));
INSERT INTO BOMON (MABM, TENBM, PHONG, DIENTHOAI, MAKHOA, NGAYNHANCHUC) VALUES (N'SH', N'Sinh hóa', N'B33', N'0838898989', N'SH', NULL);
INSERT INTO BOMON (MABM, TENBM, PHONG, DIENTHOAI, MAKHOA, NGAYNHANCHUC) VALUES (N'VLĐT', N'Vật lý điện tử', N'B23', N'0838234234', N'VL', NULL);
INSERT INTO BOMON (MABM, TENBM, PHONG, DIENTHOAI, MAKHOA, NGAYNHANCHUC) VALUES (N'VLƯD', N'Vật lý ứng dụng', N'B24', N'0838454545', N'VL', CAST(N'2006-02-18' AS Date));
INSERT INTO BOMON (MABM, TENBM, PHONG, DIENTHOAI, MAKHOA, NGAYNHANCHUC) VALUES (N'VS', N'Vi sinh', N'B32', N'0838909090', N'SH', CAST(N'2007-01-01' AS Date));



INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM) VALUES (N'001', N'Nguyễn Hoài An', 2000.0, N'Nam', CAST(N'1973-02-15' AS Date), N'25/3 Lạc Long Quân, Q.10, TP HCM', NULL, N'MMT');
INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM) VALUES (N'002', N'Trần Trà Hương', 2500.0 , N'Nữ', CAST(N'1960-06-20' AS Date), N'125 Trần Hưng Đạo, Q.1, TP HCM', NULL, N'HTTT');
INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM) VALUES (N'003', N'Nguyễn Ngọc Ánh', 2200.0 , N'Nữ', CAST(N'1975-05-11' AS Date), N'12/21 Võ Văn Ngân Thủ Đức, TP HCM', N'002', N'HTTT');
INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM) VALUES (N'004', N'Trương Nam Sơn', 2300.0 , N'Nam', CAST(N'1959-06-20' AS Date), N'215 Lý Thường Kiệt, TP Biên Hòa', NULL, N'VS');
INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM) VALUES (N'005', N'Lý Hoàng Hà', 2500.0 , N'Nam', CAST(N'1954-10-23' AS Date), N'22/5 Nguyễn Xí, Q.Bình Thạnh, TP HCM', NULL, N'VLĐT');
INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM) VALUES (N'006', N'Trần Bạch Tuyết', 1500.0 , N'Nữ', CAST(N'1980-05-20' AS Date), N'127 Hùng Vương, TP Mỹ Tho', N'004', N'VS');
INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM) VALUES (N'007', N'Nguyễn An Trung', 2100.0 , N'Nam', CAST(N'1976-06-05' AS Date), N'234 3/2, TP Biên Hòa', NULL, N'HPT');
INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM) VALUES (N'008', N'Trần Trung Hiếu', 1800.0 , N'Nam', CAST(N'1977-08-06' AS Date), N'22/11 Lý Thường Kiệt', N'007', N'HPT');
INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM) VALUES (N'009', N'Trần Hoàng Nam', 2000.0 , N'Nam', CAST(N'1975-11-22' AS Date), N'234 Trần Não, An Phú, TP HCM', N'001', N'MMT');
INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM) VALUES (N'010', N'Phạm Nam Thanh', 1500.0 , N'Nam', CAST(N'1980-12-12' AS Date), N'221 Hùng Vương, Q.5, TP HCM', N'007', N'HPT');



ALTER TABLE CONGVIEC
ADD CONSTRAINT FK_CV_MADT FOREIGN KEY (MADT) REFERENCES DETAI(MADT);

ALTER TABLE DETAI
ADD CONSTRAINT FK_DT_GVCNDT FOREIGN KEY (MACD) REFERENCES CHUDE(MACD);

ALTER TABLE DETAI
ADD CONSTRAINT FK_DT_CD FOREIGN KEY (GVCNDT) references GIAOVIEN(MAGV);

ALTER TABLE NGUOITHAN
ADD CONSTRAINT FK_NT_GV foreign key (MAGV) references GIAOVIEN(MAGV);

ALTER TABLE GV_DT
ADD CONSTRAINT FK_DT_GV foreign key (MAGV) references GIAOVIEN(MAGV);


ALTER TABLE THAMGIADT
ADD CONSTRAINT FK_TGDT_GV foreign key(MAGV) references GIAOVIEN(MAGV);

ALTER TABLE THAMGIADT
ADD CONSTRAINT FK_TGDT_CV foreign key(MADT,STT) references CONGVIEC(MADT,SOTT);


ALTER TABLE GIAOVIEN 
ADD CONSTRAINT FK_GV_BM FOREIGN KEY(MABM) references BOMON(MABM);

ALTER TABLE GIAOVIEN
ADD CONSTRAINT FK_GV_GVQLCM foreign key (GVQLCM) references GIAOVIEN(MAGV);


ALTER TABLE BOMON
ADD CONSTRAINT FK_BM_KHOA foreign key (MAKHOA) references KHOA(MAKHOA);


ALTER TABLE BOMON
ADD CONSTRAINT FK_BM_TRUONGBM foreign key (TRUONGBM) references GIAOVIEN(MAGV);


ALTER TABLE KHOA
ADD CONSTRAINT FK_KHOA_TRUONGKHOA foreign key(TRUONGKHOA) references GIAOVIEN(MAGV);

UPDATE KHOA SET KHOA.TRUONGKHOA = '002' WHERE KHOA.MAKHOA = 'CNTT';
UPDATE KHOA SET KHOA.TRUONGKHOA = '007' WHERE KHOA.MAKHOA = 'HH';
UPDATE KHOA SET KHOA.TRUONGKHOA = '004' WHERE KHOA.MAKHOA = 'SH';
UPDATE KHOA SET KHOA.TRUONGKHOA = '005' WHERE KHOA.MAKHOA = 'VL';


UPDATE BOMON SET BOMON.TRUONGBM = '007' WHERE BOMON.MABM = 'HPT';
UPDATE BOMON SET BOMON.TRUONGBM = '002' WHERE BOMON.MABM = 'HTTT';
UPDATE BOMON SET BOMON.TRUONGBM = '001' WHERE BOMON.MABM = 'MMT';
UPDATE BOMON SET BOMON.TRUONGBM = '005' WHERE BOMON.MABM = 'VLƯD';
UPDATE BOMON SET BOMON.TRUONGBM = '004' WHERE BOMON.MABM = 'VS';

ALTER TABLE BOMON DROP FOREIGN KEY FK_BM_KHOA;

INSERT INTO DETAI (MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT) VALUES (N'001', N'HTTT quản lý các trường ĐH', N'ĐHQG', 20.0 , CAST(N'2004-10-20' AS Date), CAST(N'2008-10-20' AS Date), N'QLGD', N'002');
INSERT INTO DETAI (MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT) VALUES (N'002', N'HTTT quản lý giáo vụ cho một khoa', N'Trường', 20.0 , CAST(N'2000-10-12' AS Date), CAST(N'2001-10-12' AS Date), N'QLGD', N'002');
INSERT INTO DETAI (MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT) VALUES (N'003', N'Nghiên cứu chế tạo sợi Nanô Platin', N'ĐHQG', 300.0 , CAST(N'2008-05-15' AS Date), CAST(N'2010-05-15' AS Date), N'NCPT', N'005');
INSERT INTO DETAI (MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT) VALUES (N'004', N'Tạo vật liệu sinh học bằng màng ối người', N'Nhà nước', 100.0, CAST(N'2007-01-01' AS Date), CAST(N'2009-12-31' AS Date), N'NCPT', N'004');
INSERT INTO DETAI (MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT) VALUES (N'005', N'Ứng dụng hóa học xanh', N'Trường', 200.0 , CAST(N'2003-10-10' AS Date), CAST(N'2004-12-10' AS Date), N'ƯDCN', N'007');
INSERT INTO DETAI (MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT) VALUES (N'006', N'Nghiên cứu tế bào gốc', N'Nhà nước', 4000.0 , CAST(N'2006-10-20' AS Date), CAST(N'2009-10-20' AS Date), N'NCPT', N'004');
INSERT INTO DETAI (MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT) VALUES (N'007', N'HTTT quản lý thư viện ở các trường đại học', N'Trường', 20.0 , CAST(N'2009-05-10' AS Date), CAST(N'2010-05-10' AS Date), N'QLGD', N'001');

INSERT INTO THAMGIADT (MAGV, MADT, STT, PHUCAP, KETQUA) VALUES (N'001', N'002', 1, 0.0 , NULL);
INSERT INTO THAMGIADT (MAGV, MADT, STT, PHUCAP, KETQUA) VALUES (N'001', N'002', 2, 2.0, NULL);
INSERT INTO THAMGIADT (MAGV, MADT, STT, PHUCAP, KETQUA) VALUES (N'002', N'001', 4, 2.0 , N'Đạt');
INSERT INTO THAMGIADT (MAGV, MADT, STT, PHUCAP, KETQUA) VALUES (N'003', N'001', 1, 1.0, N'Đạt');
INSERT INTO THAMGIADT (MAGV, MADT, STT, PHUCAP, KETQUA) VALUES (N'003', N'001', 2, 0.0, N'Đạt');
INSERT INTO THAMGIADT (MAGV, MADT, STT, PHUCAP, KETQUA) VALUES (N'003', N'001', 4, 1.0, N'Đạt');
INSERT INTO THAMGIADT (MAGV, MADT, STT, PHUCAP, KETQUA) VALUES (N'003', N'002', 2, 0.0, NULL);
INSERT INTO THAMGIADT (MAGV, MADT, STT, PHUCAP, KETQUA) VALUES (N'004', N'006', 1, 0.0, N'Đạt');
INSERT INTO THAMGIADT (MAGV, MADT, STT, PHUCAP, KETQUA) VALUES (N'004', N'006', 2, 1.0, N'Đạt');
INSERT INTO THAMGIADT (MAGV, MADT, STT, PHUCAP, KETQUA) VALUES (N'006', N'006', 2, 1.5, N'Đạt');
INSERT INTO THAMGIADT (MAGV, MADT, STT, PHUCAP, KETQUA) VALUES (N'009', N'002', 3, 0.5, NULL);
INSERT INTO THAMGIADT (MAGV, MADT, STT, PHUCAP, KETQUA) VALUES (N'009', N'002', 4, 1.5, NULL);

INSERT INTO NGUOITHAN (MAGV, TEN, NGSINH, PHAI) VALUES (N'001', N'Hùng', CAST(N'1990-01-14' AS Date), N'Nam');
INSERT INTO NGUOITHAN (MAGV, TEN, NGSINH, PHAI) VALUES (N'001', N'Thủy', CAST(N'1994-12-05' AS Date), N'Nữ');
INSERT INTO NGUOITHAN (MAGV, TEN, NGSINH, PHAI) VALUES (N'003', N'Hà', CAST(N'1997-09-03' AS Date), N'Nữ');
INSERT INTO NGUOITHAN (MAGV, TEN, NGSINH, PHAI) VALUES (N'003', N'Thu', CAST(N'1998-09-03' AS Date), N'Nữ');
INSERT INTO NGUOITHAN (MAGV, TEN, NGSINH, PHAI) VALUES (N'007', N'Mai', CAST(N'2003-03-26' AS Date), N'Nữ');
INSERT INTO NGUOITHAN (MAGV, TEN, NGSINH, PHAI) VALUES (N'007', N'Vy', CAST(N'2000-02-14' AS Date), N'Nữ');
INSERT INTO NGUOITHAN (MAGV, TEN, NGSINH, PHAI) VALUES (N'008', N'Nam', CAST(N'1991-05-06' AS Date), N'Nam');
INSERT INTO NGUOITHAN (MAGV, TEN, NGSINH, PHAI) VALUES (N'009', N'An', CAST(N'1996-08-19' AS Date), N'Nam');
INSERT INTO NGUOITHAN (MAGV, TEN, NGSINH, PHAI) VALUES (N'010', N'Nguyệt', CAST(N'2006-01-14' AS Date), N'Nữ');

INSERT INTO GV_DT (MAGV, DIENTHOAI) VALUES (N'001', N'0838912112');
INSERT INTO GV_DT (MAGV, DIENTHOAI) VALUES (N'001', N'0903123123');
INSERT INTO GV_DT (MAGV, DIENTHOAI) VALUES (N'002', N'0913454545');
INSERT INTO GV_DT (MAGV, DIENTHOAI) VALUES (N'003', N'0838121212');
INSERT INTO GV_DT (MAGV, DIENTHOAI) VALUES (N'003', N'0903656565');
INSERT INTO GV_DT (MAGV, DIENTHOAI) VALUES (N'003', N'0937125125');
INSERT INTO GV_DT (MAGV, DIENTHOAI) VALUES (N'006', N'0937888888');
INSERT INTO GV_DT (MAGV, DIENTHOAI) VALUES (N'008', N'0653717171');
INSERT INTO GV_DT (MAGV, DIENTHOAI) VALUES (N'008', N'0913232323');


INSERT INTO CONGVIEC (MADT, SOTT, TENCV, NGAYBD, NGAYKT) VALUES (N'001', 1, N'Khởi tạo và Lập kế hoạch', CAST(N'2007-10-20' AS Date), CAST(N'2008-12-20' AS Date));
INSERT INTO CONGVIEC (MADT, SOTT, TENCV, NGAYBD, NGAYKT) VALUES (N'001', 2, N'Xác định yêu cầu', CAST(N'2008-12-21' AS Date), CAST(N'2008-03-21' AS Date));
INSERT INTO CONGVIEC (MADT, SOTT, TENCV, NGAYBD, NGAYKT) VALUES (N'001', 3, N'Phân tích hệ thống', CAST(N'2008-03-22' AS Date), CAST(N'2008-05-22' AS Date));
INSERT INTO CONGVIEC (MADT, SOTT, TENCV, NGAYBD, NGAYKT) VALUES (N'001', 4, N'Thiết kế hệ thống', CAST(N'2008-05-23' AS Date), CAST(N'2008-06-23' AS Date));
INSERT INTO CONGVIEC (MADT, SOTT, TENCV, NGAYBD, NGAYKT) VALUES (N'001', 5, N'Cài đặt thử nghiệm', CAST(N'2008-06-24' AS Date), CAST(N'2008-10-20' AS Date));
INSERT INTO CONGVIEC (MADT, SOTT, TENCV, NGAYBD, NGAYKT) VALUES (N'002', 1, N'Khởi tạo và Lập kế hoạch', CAST(N'2009-05-10' AS Date), CAST(N'2009-07-10' AS Date));
INSERT INTO CONGVIEC (MADT, SOTT, TENCV, NGAYBD, NGAYKT) VALUES (N'002', 2, N'Xác định yêu cầu', CAST(N'2009-07-11' AS Date), CAST(N'2009-10-11' AS Date));
INSERT INTO CONGVIEC (MADT, SOTT, TENCV, NGAYBD, NGAYKT) VALUES (N'002', 3, N'Phân tích hệ thống', CAST(N'2009-10-12' AS Date), CAST(N'2009-12-20' AS Date));
INSERT INTO CONGVIEC (MADT, SOTT, TENCV, NGAYBD, NGAYKT) VALUES (N'002', 4, N'Thiết kế hệ thống', CAST(N'2009-12-21' AS Date), CAST(N'2010-03-22' AS Date));
INSERT INTO CONGVIEC (MADT, SOTT, TENCV, NGAYBD, NGAYKT) VALUES (N'002', 5, N'Cài đặt thử nghiệm', CAST(N'2010-03-23' AS Date), CAST(N'2010-05-10' AS Date));
INSERT INTO CONGVIEC (MADT, SOTT, TENCV, NGAYBD, NGAYKT) VALUES (N'006', 1, N'Lấy mẫu', CAST(N'2006-10-20' AS Date), CAST(N'2007-02-20' AS Date));
INSERT INTO CONGVIEC (MADT, SOTT, TENCV, NGAYBD, NGAYKT) VALUES (N'006', 2, N'Nuôi cấy', CAST(N'2007-02-21' AS Date), CAST(N'2008-08-21' AS Date))

